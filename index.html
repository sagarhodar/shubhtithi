<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jyotish Calendar - Muhurat Timings</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B35">
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main Container -->
    <div id="app" class="app-container">
        
        <!-- Admin Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content login-modal">
                <div class="modal-header">
                    <h3>üïâÔ∏è Admin Login</h3>
                </div>
                <div class="modal-body">
                    <p style="text-align: center; margin-bottom: 30px; color: #666;">
                        Sign in with Google to access admin features
                    </p>
                    <button id="googleSignInBtn" class="google-signin-btn">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                            <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                            <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                            <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                            <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                        </svg>
                        Sign in with Google
                    </button>
                    <button class="modal-btn cancel" onclick="closeLoginModal()" style="margin-top: 15px; width: 100%;">Cancel</button>
                </div>
            </div>
        </div>

        <!-- 2FA Setup Modal -->
        <div id="setup2FAModal" class="modal">
            <div class="modal-content login-modal">
                <div class="modal-header">
                    <h3>üîê Setup 2FA Authentication</h3>
                </div>
                <div class="modal-body">
                    <p style="text-align: center; margin-bottom: 20px; color: #666;">
                        Scan this QR code with Google Authenticator app
                    </p>
                    <div id="qrCodeContainer" class="qrcc" style="text-align: center; margin: 20px 0;"></div>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 8px; text-align: center;">Manual Entry Key:</p>
                        <p id="secretKeyDisplay" style="font-family: monospace; font-size: 1.1rem; text-align: center; word-break: break-all; color: #000; font-weight: 600;"></p>
                    </div>
                    <div class="form-group">
                        <label>Enter 6-digit code from app</label>
                        <input type="text" id="verifyOtpInput" class="form-input" placeholder="000000" maxlength="6" pattern="[0-9]{6}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel" onclick="close2FASetupModal()">Cancel</button>
                    <button id="verify2FABtn" class="modal-btn primary">Verify & Enable</button>
                </div>
            </div>
        </div>

        <!-- 2FA Verify Modal -->
        <div id="verify2FAModal" class="modal">
            <div class="modal-content login-modal">
                <div class="modal-header">
                    <h3>üîê Enter 2FA Code</h3>
                </div>
                <div class="modal-body">
                    <p style="text-align: center; margin-bottom: 30px; color: #666;">
                        Enter the 6-digit code from your authenticator app
                    </p>
                    <div class="form-group">
                        <input type="text" id="otp2FAInput" class="form-input" placeholder="000000" maxlength="6" pattern="[0-9]{6}" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel" onclick="close2FAVerifyModal()">Cancel</button>
                    <button id="submit2FABtn" class="modal-btn primary">Verify</button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">üïâÔ∏è Jyotish Muhurat Calendar</h1>
                <div class="header-actions">
                    <div id="userInfo" class="user-info" style="display: none;">
                        <img id="userPhoto" class="user-photo" src="" alt="User">
                        <span id="userName" class="user-name"></span>
                        <button id="logoutBtn" class="logout-btn">Logout</button>
                    </div>
                    <button id="adminToggleBtn" class="admin-toggle-btn">Admin Mode</button>
                </div>
            </div>
        </header>

        <!-- Public View -->
        <div id="publicView" class="view-container active">
            <div class="controls-wrapper">
                <button id="viewToggleBtn" class="view-toggle-btn">
                    <span id="viewToggleIcon">üìÖ</span>
                    <span id="viewToggleText">Switch to List View</span>
                </button>
            </div>

            <div id="calendarContainer" class="calendar-container">
                <div class="calendar-header">
                    <button id="prevMonthBtn" class="month-nav-btn">‚Üê</button>
                    <h2 id="currentMonthYear" class="month-title"></h2>
                    <button id="nextMonthBtn" class="month-nav-btn">‚Üí</button>
                </div>
                <div id="calendarGrid" class="calendar-grid"></div>
            </div>

            <div id="listContainer" class="list-container" style="display: none;">
                <div id="entryList" class="entry-list"></div>
            </div>
        </div>

        <!-- Admin View - NEW WORKFLOW -->
        <div id="adminView" class="view-container">
            
            <!-- Admin Calendar for Date Selection -->
            <div id="adminCalendarSection" class="admin-section">
                <div class="calendar-header">
                    <button id="adminPrevMonth" class="month-nav-btn">‚Üê Previous</button>
                    <h2 id="adminMonthYear" class="month-title"></h2>
                    <button id="adminNextMonth" class="month-nav-btn">Next ‚Üí</button>
                </div>
                <div id="adminCalendarGrid" class="admin-calendar-grid"></div>
            </div>

            <!-- Control Panel -->
            <div id="controlPanel" class="control-panel">
                <div id="panelContent" class="panel-content">
                    <!-- Dynamic content based on step -->
                </div>
                <div id="panelButtons" class="panel-buttons">
                    <button id="cancelBtn" class="panel-btn cancel-btn" onclick="resetWorkflow()">Cancel</button>
                    <button id="reviewBtn" class="panel-btn review-btn" onclick="openReviewMode()">Review</button>
                </div>
            </div>

        </div>

        <!-- Review Modal -->
        <div id="reviewModal" class="modal">
            <div class="modal-content review-modal">
                <div class="modal-header">
                    <h3>Review Saved Entries</h3>
                    <button class="close-btn" onclick="closeReviewModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div id="reviewEntriesList" class="review-entries-list"></div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn primary" onclick="closeReviewModal()">Back</button>
                </div>
            </div>
        </div>

        <!-- Modal for Day View -->
        <div id="dayViewModal" class="modal">
            <div class="modal-content day-view-modal">
                <div class="modal-header">
                    <h3 id="dayViewTitle">Day Entries</h3>
                    <button class="close-btn" onclick="closeDayViewModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div id="dayViewEntries" class="day-entries"></div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
        </div>

        <!-- Footer Credit -->
        <footer class="app-footer">
            <p>Developed by <a href="https://sagarhodar.pages.dev">Sagar Hodar</a></p>
        </footer>


    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- TOTP Library for 2FA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/otpauth/9.1.4/otpauth.umd.min.js"></script>
    
    <!-- App Configuration and Logic -->
    <script src="firebase-config.js"></script>
    <script src="app.js"></script>
</body>
</html>